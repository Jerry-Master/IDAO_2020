---
title: "Models lineals recursius"
output: html_notebook
---
Llibraries
```{r}
library(readr)
library(car)
library(emmeans)
library(tables)
library(RcmdrMisc)
library(dplyr)
```
Dades
```{r}
dd <- read_csv("train.csv")
dd$dist <- sqrt(dd$x^2 + dd$y^2 + dd$z^2)
dd$epoch <- as.numeric(as.POSIXct(dd$epoch))
dd$epoch <- dd$epoch - min(dd$epoch)

test <- read_csv("test.csv")
test$epoch <- as.numeric(as.POSIXct(test$epoch))
test$epoch <- test$epoch - min(test$epoch)
head(test)
```

CreaciÃ³ d'una base de dades dels predict
```{r}
for (i in unique(test$sat_id)){
  i = 1
 ddi <- filter(dd, sat_id==i)
 testi <- filter(test, sat_id==i)
  
 lmX <- lm(x ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmY <- lm(y ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmZ <- lm(z ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)

 lmVx <- lm(Vx ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmVy <- lm(Vy ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmVz <- lm(Vz ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
  

 ddi2 <- data.frame(id = ddi$id, x=ddi$x, y=ddi$y, z=ddi$z, Vx=ddi$Vx, Vy=ddi$Vy, Vz=ddi$Vz, 
                    x_sim=predict(lmX), y_sim=predict(lmY), z_sim=predict(lmZ), 
                    Vx_sim=predict(lmVx), Vy_sim=predict(lmVy), Vz_sim=predict(lmVz))

  
 lmX2 <- lm(x ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi2)
 lmY2 <- lm(y ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi2)
 lmZ2 <- lm(z ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi2)

 lmVx2 <- lm(Vx ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi2)
 lmVy2 <- lm(Vy ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi2)
 lmVz2 <- lm(Vz ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi2)

 testi2 <- data.frame(id = testi$id, x_sim=predict(lmX, testi), y_sim=predict(lmY, testi), z_sim=predict(lmZ, testi), 
                    Vx_sim=predict(lmVx, testi), Vy_sim=predict(lmVy, testi), Vz_sim=predict(lmVz, testi))
 
 
 
 
 
 if (i == 1) {
  ans <- data.frame(id = testi$id, x=predict(lmX2, testi2), y=predict(lmY2, testi2), z=predict(lmZ2, testi2), 
                    Vx=predict(lmVx2, testi2), Vy=predict(lmVy2, testi2), Vz=predict(lmVz2, testi2))
 } else{
  ans <- rbind(ans, data.frame(id = testi$id, x=predict(lmX2, testi2), y=predict(lmY2, testi2), z=predict(lmZ2, testi2), 
                               Vx=predict(lmVx2, testi2), Vy=predict(lmVy2, testi2), Vz=predict(lmVz2, testi2)))
 }
}
```


Passar a csv
```{r}
ans$id <- format(ans$id, scientific = F)
ans$x <- format(ans$x, scientific = F)
ans$y <- format(ans$y, scientific = F)
ans$z <- format(ans$z, scientific = F)
ans$Vx <- format(ans$Vx, scientific = F)
ans$Vy <- format(ans$Vy, scientific = F)
ans$Vz <- format(ans$Vz, scientific = F)

write.csv(ans, "submission.csv", quote = F, row.names = F)
```
















No es fa servir

```{r}
for (i in unique(test$sat_id)){
 ddi <- filter(dd, sat_id==i)
 testi <- filter(test, sat_id==i)
  
 lmX <- lm(x ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmY <- lm(y ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmZ <- lm(z ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)

 lmVx <- lm(Vx ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmVy <- lm(Vy ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
 lmVz <- lm(Vz ~ x_sim+y_sim+z_sim+Vx_sim+Vy_sim+Vz_sim, ddi)
  
 if (i == 1) {
  ans <- data.frame(id = testi$id, x=predict(lmX, testi), y=predict(lmY, testi), z=predict(lmZ, testi), 
                    Vx=predict(lmVx, testi), Vy=predict(lmVy, testi), Vz=predict(lmVz, testi))
 } else{
  ans <- rbind(ans, data.frame(id = testi$id, x=predict(lmX, testi), y=predict(lmY, testi), z=predict(lmZ, testi), 
                               Vx=predict(lmVx, testi), Vy=predict(lmVy, testi), Vz=predict(lmVz, testi)))
 }
}
```
